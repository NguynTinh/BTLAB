--1

CREATE TABLE MONHOC(
MAMON CHAR(5) NOT NULL PRIMARY KEY,
TENMON NVARCHAR(40),
SOTC INT)
CREATE TABLE SINHVIEN(
MASV CHAR(5) NOT NULL PRIMARY KEY,
HOTEN NVARCHAR(40),
NGAYSINH SMALLDATETIME)
CREATE TABLE DIEM(
MASV CHAR(5) NOT NULL,
MAMON CHAR(5) NOT NULL,
DIEMTHI FLOAT,
CONSTRAINT FK_MASV FOREIGN KEY(MASV) REFERENCES SINHVIEN(MASV),
CONSTRAINT FK_MAMH FOREIGN KEY(MAMON) REFERENCES MONHOC(MAMON),
CONSTRAINT PK_MASV_MAMH PRIMARY KEY(MASV, MAMON))
GO 
INSERT INTO MONHOC VALUES
('MM1','AN',2),
('MM2','NGU',3),
('MM3','TIEN',3)
INSERT INTO SINHVIEN VALUES
('SV1','THIEN TINH','2001-9-30'),
('SV2','THIEN PHUC','2002-6-25'),
('SV3','NGOC THIEN','2002-7-14')
INSERT INTO DIEM VALUES
('SV1','MM1',9),
('SV1','MM2',3),
('SV1','MM3',4),
('SV2','MM1',3),
('SV2','MM2',3),
('SV2','MM3',4),
('SV3','MM1',2),
('SV3','MM2',3),
('SV3','MM3',5)

 GO

 SELECT *
 FROM MONHOC

 GO

 SELECT *
 FROM SINHVIEN

 GO
 SELECT *
 FROM DIEM

 --2

GO
CREATE FUNCTION THONGKE (@TMH NVARCHAR(20))
RETURNS INT
AS
BEGIN
DECLARE @DEM INT
SET @DEM = (SELECT COUNT(@TMH) FROM DIEM JOIN MONHOC ON MONHOC.MAMON = DIEM.MAMON WHERE DIEM.DIEMTHI<5)
RETURN @DEM
END
GO
SELECT DBO.THONGKE('AN')

--3

GO
CREATE PROCEDURE NHAPDIEM(@MASV CHAR(5),@MAMON CHAR(5), @DIEMTHI FLOAT)
AS
INSERT INTO DIEM(MASV,MAMON,DIEMTHI) VALUES(@MASV,@MAMON,@DIEMTHI)
GO
NHAPDIEM 'SV03','MM3',4
GO

--4

CREATE TRIGGER THEM_SUA
ON DIEM
FOR  INSERT, UPDATE
AS
IF(SELECT DIEMTHI FROM INSERTED)>10 AND (SELECT DIEMTHI FROM INSERTED)<0
BEGIN
PRINT
'KHONG CHO PHEP'
ROLLBACK TRANSACTION
END
INSERT INTO DIEM VALUES ('001','MH3','2')